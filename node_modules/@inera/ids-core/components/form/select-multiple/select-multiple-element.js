import{__decorate as e}from"tslib";import{html as t}from"lit";import{FormBaseElement as s}from"../base/form-base-element.js";import i from"./select-multiple-styles.js";import{property as l,state as r}from"lit/decorators.js";import{GroupErrorController as o}from"../controller/GroupErrorController.js";import d from"../../styles/global-styles.js";class h extends s{constructor(){super(...arguments),this.groupErrorController=new o(this),this.placeholder="",this.maxheight="",this.label="",this.selectedlabel="vald",this.multiselectedlabel="valda",this.selectedValues=[],this.isDropdownVisible=!1,this.handleValueChange=e=>{e.currentTarget.querySelector("input").setAttribute("aria-selected",e.target.checked),e.currentTarget.querySelector("input").setAttribute("aria-checked",e.target.checked),this.setSelectedValues()},this.setSelectedValues=()=>{this.selectedValues=[],this.checkboxes.forEach((e=>{if(e.querySelector("input")?.checked){const t=e.querySelector("label")?.innerText;t&&this.selectedValues.push(t)}}));const e={composed:!0,bubbles:!0,detail:this.selectedValues};this.dispatchEvent(new CustomEvent("change",e))},this.handleTab=e=>{"Tab"!==e.key||e.shiftKey||this.hideDropdown()},this.handleEscape=e=>{this.isDropdownVisible&&"Escape"===e.key&&this.hideDropdown()},this.toggleVisibility=()=>{this.isDropdownVisible?this.hideDropdown():this.showDropdown()},this.hideDropdown=()=>{this.isDropdownVisible=!1,this.dropdownArea?.classList.add("hide")},this.showDropdown=()=>{this.isDropdownVisible=!0,this.dropdownArea?.classList.remove("hide")},this.detectClickOutside=e=>{this.contains(e.target)||this.hideDropdown()}}get checkboxes(){return this.querySelectorAll("ids-checkbox")}get dropdownArea(){return this.shadowRoot?.querySelector("#ids-dropdown-area")}get checkboxInputs(){return this.querySelectorAll("input")}firstUpdated(e){super.firstUpdated(e),this.setSelectedValues(),this.setupEventListeners()}disconnectedCallback(){this.removeEventListeners(),super.disconnectedCallback()}setupEventListeners(){document.addEventListener("click",this.detectClickOutside),this.checkboxes.forEach((e=>{e.addEventListener("keydown",this.handleEscape),e.addEventListener("change",this.handleValueChange)})),this.checkboxes[this.checkboxes.length-1].addEventListener("keydown",this.handleTab)}removeEventListeners(){document.removeEventListener("click",this.detectClickOutside),this.checkboxes.forEach((e=>{e.removeEventListener("keydown",this.handleEscape),e.removeEventListener("change",this.handleValueChange)}))}renderLabel(){return this.label&&this.label.length>0?t`<div @click="${this.hideDropdown}" id="ids-label-wrapper"><label id="ids-multiselect-label">${this.label}</label></div>`:""}getValue(){if(Array.from(this.querySelectorAll("input")).filter((e=>!e.checked&&e.required)).length>0)return this.placeholder;const e=this.selectedValues.length>1?this.multiselectedlabel:this.selectedlabel;return this.selectedValues.length>0?`${this.selectedValues.length} ${e}`:this.placeholder}render(){return t`${this.renderLabel()}<div class="ids-input-wrapper"><input @click="${this.toggleVisibility}" aria-expanded="${this.isDropdownVisible}" aria-labelledby="ids-multiselect-label" class="focusable ${0===this.selectedValues.length?"placeholder":""}" type="button" .value="${this.getValue()}"><ids-icon-chevron-bold class="ids-icon ${this.isDropdownVisible?"ids-chevron-rotated":""}" size="xs"></div><div id="ids-dropdown-area-wrapper"><div id="ids-dropdown-area" class="hide"><div id="ids-dropdown-area-inner" style="max-height:${this.maxheight}" class="ids-scrollbar"><slot></slot></div></div></div><slot name="error-msg"></slot>`}}h.styles=[d,...s.styles,i],e([l({type:String})],h.prototype,"placeholder",void 0),e([l({type:String})],h.prototype,"maxheight",void 0),e([l({type:String})],h.prototype,"label",void 0),e([l({type:String,reflect:!0})],h.prototype,"selectedlabel",void 0),e([l({type:String,reflect:!0})],h.prototype,"multiselectedlabel",void 0),e([r()],h.prototype,"selectedValues",void 0),e([r()],h.prototype,"isDropdownVisible",void 0);export{h as IDSSelectMultiple};

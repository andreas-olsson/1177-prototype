import{__decorate as t}from"tslib";import{LitElement as i,html as s}from"lit";import{property as e,state as a}from"lit/decorators.js";import{logWarning as o}from"../../utilities/utils.js";import l from"./carousel-styles.js";class h extends i{constructor(){super(...arguments),this.autoplay=!1,this.srnextlabel="Nästa slide",this.srprevlabel="Föregående slide",this.autoplaydelay=5e3,this.activeSlideIndex=0,this.isAnimating=!1,this.isAnimatingLeft=!1,this.isAnimatingRight=!1,this.itemClassName="carousel-slide",this.touchStartX=0,this.touchEndX=0,this.nextSlide=()=>{this.isAnimating||(this.isAnimatingRight=!0,this.resetSlides(),this.activeSlideIndex===this.slidesCount-1?this.activeSlideIndex=0:this.activeSlideIndex++,this.moveToActiveSlide())}}get slides(){return Array.from(this.children)}get images(){return this.querySelectorAll("img")}get slidesCount(){return this.slides.length}firstUpdated(t){super.firstUpdated(t),this.slidesCount<3&&o(this,"Carousel requires at least 3 carousel-items."),this.autoplay&&this.startAutoplay(),this.setupCarousel(),this.addSlideFunctionality(),this.detectResize(),this.images[0]?.addEventListener("load",(()=>{this.setButtonLocation(),this.displayButtons()}))}updated(t){super.updated(t),t.has("autoplay")&&this.autoplay&&this.startAutoplay()}detectResize(){new ResizeObserver((t=>{t.forEach((()=>{this.setButtonLocation()}))})).observe(this.shadowRoot?.querySelector(".carousel"))}setButtonLocation(){const t=this.querySelector('[slot="image"]')?.offsetHeight,i=t/2;this.shadowRoot?.querySelectorAll("button").forEach((s=>{s.style.top=`${i}px`,s.style.height=`${t}px`}))}displayButtons(){this.shadowRoot?.querySelectorAll("button").forEach((t=>{setTimeout((()=>{t.style.opacity="1"}),200)}))}startAutoplay(){this.autoplay&&(this.autoplaydelay<500&&(this.autoplaydelay=500),setTimeout((()=>{this.nextSlide(),this.startAutoplay()}),this.autoplaydelay))}setupCarousel(){this.slidesCount>2&&(this.slides.forEach((t=>{t.classList.add(this.itemClassName),t.setAttribute("aria-hidden","true")})),this.slides[this.slidesCount-1]?.classList.add("prev"),this.slides[0]?.classList.add("active"),this.slides[0]?.setAttribute("aria-hidden","false"),this.slides[1]?.classList.add("next"))}moveToActiveSlide(){this.isAnimating=!0;let t=this.activeSlideIndex-1,i=this.activeSlideIndex+1;0===this.activeSlideIndex?t=this.slidesCount-1:this.activeSlideIndex===this.slidesCount-1&&(t=this.activeSlideIndex-1,i=0),this.slidesCount>=3&&(this.slides[t].className=this.itemClassName+" prev",this.slides[this.activeSlideIndex].className=this.itemClassName+" active",this.slides[this.activeSlideIndex].setAttribute("aria-hidden","false"),this.slides[i].className=this.itemClassName+" next"),setTimeout((()=>{this.isAnimating=!1,this.isAnimatingLeft=!1,this.isAnimatingRight=!1}),500)}addSlideFunctionality(){this.addEventListener("touchstart",(t=>{this.touchStartX=t.changedTouches[0].screenX})),this.addEventListener("touchend",(t=>{this.touchEndX=t.changedTouches[0].screenX,this.checkDirection()}))}resetSlides(){this.slides.forEach((t=>{t.className=this.itemClassName,t.setAttribute("aria-hidden","true")}))}previousSlide(){this.isAnimating||(this.isAnimatingLeft=!0,this.resetSlides(),0===this.activeSlideIndex?this.activeSlideIndex=this.slidesCount-1:this.activeSlideIndex--,this.moveToActiveSlide())}checkDirection(){this.touchEndX<this.touchStartX&&this.touchStartX-this.touchEndX>=100&&this.nextSlide(),this.touchEndX>this.touchStartX&&this.touchStartX-this.touchEndX<=-100&&this.previousSlide()}getAnimationClasses(){if(this.isAnimating){return`${this.isAnimatingLeft?"animating-left":""} ${this.isAnimatingRight?"animating-right":""}`}return""}render(){return s`<div class="carousel-wrapper"><button aria-label="${this.srprevlabel}" @click="${this.previousSlide}" class="carousel-btn-prev focusable"><ids-icon-chevron color="var(--carousel-icon_color)" rotate="180" width="25"></ids-icon-chevron></button> <button aria-label="${this.srnextlabel}" @click="${this.nextSlide}" class="carousel-btn-next focusable"><ids-icon-chevron color="var(--carousel-icon_color)" width="25"></ids-icon-chevron></button> <button aria-label="${this.srprevlabel}" @click="${this.previousSlide}" class="carousel-btn-prev mobile focusable"><div class="carousel-inner-btn"><ids-icon-chevron color="white" rotate="180" width="25"></ids-icon-chevron></div></button> <button aria-label="${this.srnextlabel}" @click="${this.nextSlide}" class="carousel-btn-next mobile focusable"><div class="carousel-inner-btn"><ids-icon-chevron color="white" width="25"></ids-icon-chevron></div></button><div class="carousel ${this.getAnimationClasses()}"><div aria-live="polite"><slot></slot></div></div></div>`}}h.styles=[l],t([e({type:Boolean,reflect:!0})],h.prototype,"autoplay",void 0),t([e({type:String})],h.prototype,"srnextlabel",void 0),t([e({type:String})],h.prototype,"srprevlabel",void 0),t([e({type:Number})],h.prototype,"autoplaydelay",void 0),t([a()],h.prototype,"activeSlideIndex",void 0),t([a()],h.prototype,"isAnimating",void 0);export{h as IDSCarousel};

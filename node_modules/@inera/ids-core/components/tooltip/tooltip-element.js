import{LitElement as t,html as e}from"lit";import{generateId as i}from"../../utilities/utils.js";import s from"../styles/global-styles.js";import r from"./tooltip-styles.js";class o extends t{constructor(){super(...arguments),this.translateX="",this.translateY="",this.handleOverflow=async()=>{if(this.trigger&&this.tooltipWrapper){this.resetPosition();let{style:t}=this.tooltipWrapper;this.requestUpdate(),await this.updateComplete;let e=this.tooltipWrapper.getBoundingClientRect();let i=!1;if(e.width>document.documentElement.clientWidth){let e=this.trigger.getBoundingClientRect().x<20?20:20-this.trigger.getBoundingClientRect().x;t.left=e+"px",t.width=document.documentElement.clientWidth-40+"px",this.translateY="translateY(-100%)",i=!0}e.right+40>document.querySelector("body").offsetWidth&&!i&&(t.width="max-content",t.left="auto",t.right="0px",this.translateX="translateX(0%)");if(this.tooltipWrapper.getBoundingClientRect().x<0&&!i){t.width="max-content",t.left="0px",t.right="auto",this.translateX="translateX(0%)";this.trigger.getBoundingClientRect().x+e.width>document.documentElement.clientWidth&&(t.width=document.documentElement.clientWidth-this.trigger.getBoundingClientRect().left-40+"px")}e.top<0&&(t.top="",this.translateY="translateY(100%)",t.bottom="-10px"),t.transform=`${this.translateX} ${this.translateY}`}},this.checkKey=t=>{27===t.keyCode&&document.activeElement?.blur()}}get trigger(){return this.querySelector("[slot=trigger]")}get tooltip(){return this.querySelector("[slot=tooltip]")}get tooltipWrapper(){return this.shadowRoot?.querySelector(".tooltip-wrapper")}getFirstFocusableContent(){return this.trigger?.parentElement?this.trigger.parentElement.querySelector('ids-button, button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'):null}firstUpdated(t){super.firstUpdated(t),this.setupTrigger(),this.setupTooltip(),this.setupEventListeners()}setupEventListeners(){this.addEventListener("focusin",this.handleOverflow),this.addEventListener("mouseenter",this.handleOverflow)}resetPosition(){if(this.tooltipWrapper){let{style:t}=this.tooltipWrapper;t.width="max-content",t.left="50%",this.translateX="translateX(-50%)",this.translateY="translateY(-100%)",t.transform=`${this.translateX} ${this.translateY}`,t.top="-10px",t.bottom=""}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("focusin",this.handleOverflow),this.removeEventListener("mouseenter",this.handleOverflow)}setupTrigger(){if(this.tooltip&&this.trigger){let t=this.tooltip.getAttribute("id")||i();this.tooltip.setAttribute("id",t),"ids-icon"===this.trigger.tagName.toLocaleLowerCase()?this.getFirstFocusableContent()?.setAttribute("aria-labelledby",t):this.getFirstFocusableContent()?.setAttribute("aria-describedby",t),this.addEventListener("keydown",this.checkKey)}}setupTooltip(){this.tooltip?.setAttribute("role","tooltip")}render(){return e`<span class="popover"><span class="trigger-wrapper"><slot name="trigger"></slot></span><span class="tooltip-wrapper"><span class="tooltip"><slot name="tooltip"></slot></span></span></span>`}}o.styles=[s,r];export{o as IDSTooltip};
